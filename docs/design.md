# 智能相册应用 - 项目设计文档（开源工具版）

**版本**：2.1  
**日期**：2025年6月22日

**定位**：本项目是一个开源工具，旨在为用户提供一个以**工程（Project）**为核心、隐私优先、本地存储、可自由配置的个人照片管理与检索解决方案。

## 1. 项目概述 (Project Overview)

本项目致力于开发一款现代化的智能相册开源工具。其核心理念是让用户通过创建一个本地的**"工程文件夹"**来完全掌控自己的照片数据。所有导入的照片都会被**复制并集中存储**在该工程文件夹中，确保了数据管理的统一性和物理位置的清晰性。

后续版本将利用先进的视觉语言模型 (VLM) 技术，为用户的照片自动生成文本描述，并将这些元数据与图片一同存储在工程内，实现强大的本地化自然语言搜索。

## 2. 项目目标 (Project Goals)

- **核心目标**: 实现一个基于"工程"的照片管理系统，所有图片和元数据都集中存储在用户指定的本地文件夹中。
- **用户自主性**: 用户拥有对自己数据存储位置的绝对控制权。后续将允许用户自由配置其选择的VLM服务商。
- **隐私优先**: 所有图片文件和生成的描述数据均存储在本地工程文件夹内，不上传至任何中心化服务器。
- **易用性**: 提供一个简洁明了的图形用户界面，引导用户创建和管理自己的照片工程。
- **可扩展性**: 构建模块化的代码结构，便于社区贡献者增加新的AI模型支持或新功能。

## 3. 核心功能 (Core Features)

- **工程管理**:
    - **创建/选择工程**: 用户可以创建新文件夹或选择现有文件夹作为应用的"工程"。此工程路径将被保存，应用重启后自动加载。
- **照片导入**:
    - **导入文件夹**: 将指定文件夹中的所有图片**复制**到当前工程文件夹中。
    - **导入单张照片**: 将选中的单张图片**复制**到当前工程文件夹中。
- **照片展示**:
    - 以网格视图的形式，展示当前工程文件夹内的所有图片。

*(后续阶段功能)*
- *AI自动描述: 调用用户配置的VLM模型生成内容描述。*
- *AI服务商配置: 提供设置界面，允许用户输入API密钥和端点。*
- *本地全文搜索: 对本地数据库中的描述进行全文内容检索。*
- *描述编辑: 允许用户查看、编辑和完善AI生成的描述。*

## 4. 技术架构 (Technical Architecture)

本工具采用本地化应用架构，旨在简化部署，无需依赖复杂的后端服务。

### 4.1. 架构图

```
[用户桌面应用 (Electron封装)]
    |
    |--- [前端界面 (React/Vue)]
    |       | 1. 用户操作 (选择工程, 导入图片)
    |       v
    |--- [核心逻辑 (Node.js)]
    |       | 2. 读写配置文件 (工程路径) -> [electron-store]
    |       | 3. 复制图片文件到 -> [本地工程文件夹]
    |       | 4. (未来) 读写元数据到 -> [工程内的SQLite数据库]
    |       | 5. (未来) 调用外部API -> [第三方VLM API]
    |       v
    |--- [渲染逻辑]
    |       | 6. 从工程文件夹读取图片并显示
    v
[用户本地文件系统] <--- [工程文件夹 (Project Folder)]
```

### 4.2. 模块详解

- **应用容器 (Application Shell)**:
    - **技术栈**: Electron 或 Tauri。
    - **职责**: 将应用打包成独立的桌面程序，提供访问本地文件系统的能力。

- **前端 (Frontend)**:
    - **技术栈**: 原生 HTML/CSS/JS (初期), React/Vue (未来)。
    - **职责**: 提供用户操作界面，包括工程选择、图片导入、照片展示等。

- **核心逻辑 (Core Logic)**:
    - **技术栈**: Node.js (集成在Electron主进程中)。
    - **职责**:
        - 处理来自界面的所有操作请求。
        - 响应用户的选择，将图片文件**复制**到指定的工程文件夹中。
        - (未来) 操作本地数据库（读写照片元数据和描述）。

- **配置管理 (Configuration Management)**:
    - **技术栈**: `electron-store`。
    - **职责**: 持久化存储用户的配置信息，最核心的是**工程文件夹的路径**。

- **数据存储 (Data Storage)**:
    - **图片文件存储**: 所有图片文件均被**复制**到用户指定的工程文件夹内。这是数据的唯一来源 (Single Source of Truth)。
    - **元数据与描述存储 (未来)**:
        - **选型**: SQLite。
        - **职责**: 在工程文件夹内创建一个 `.db` 文件，用于存储所有照片的路径、EXIF信息、AI描述和用户标签。数据库与工程绑定，便于整体迁移和备份。

## 5. 核心工作流程 (Core Workflows)

### 5.1. 应用首次启动/未设置工程
1.  **用户操作**: 用户启动应用。
2.  **核心逻辑**: 应用通过 `electron-store` 查找已保存的工程路径。
3.  **前端渲染**: 未找到工程路径。界面显示"未选择工程"状态，**"导入"功能按钮被禁用**。
4.  **用户操作**: 用户点击"创建/选择工程文件夹"按钮。
5.  **核心逻辑**: 弹出系统对话框，让用户选择或创建一个文件夹。路径被选定后，保存到 `electron-store`。
6.  **前端更新**: 界面显示新的工程路径，并**启用"导入"按钮**。如果工程文件夹内已有图片，则直接加载并显示。

### 5.2. 照片导入流程 (已设置工程)
1.  **用户操作**: 用户点击"导入文件夹"或"导入单张照片"。
2.  **核心逻辑**: 弹出对话框让用户选择源文件/文件夹。
3.  **核心逻辑**: 遍历所有源图片，将其**复制**到当前激活的工程文件夹内。
4.  **前端更新**: 渲染器重新读取工程文件夹的内容，将新增的图片显示在视图中。

## 6. 数据模型 (Data Model) - 未来阶段

**Photos 表 (在SQLite中)**:
```sql
CREATE TABLE Photos (
  photoId INTEGER PRIMARY KEY AUTOINCREMENT,
  -- filePath 现在是图片在工程文件夹中的相对或绝对路径，这使得整个工程可以被移动
  filePath TEXT NOT NULL UNIQUE, 
  descriptionAI TEXT,
  descriptionUser TEXT,
  tags TEXT, -- JSON array stored as TEXT
  takenAt TEXT, -- ISO 8601 format
  location TEXT, -- JSON object with lat, lon, name
  createdAt TEXT,
  updatedAt TEXT
);
```

## 7. 潜在挑战与解决方案

- **存储空间管理**:
  - **挑战**: 将所有照片复制一份到工程文件夹，会占用额外的硬盘空间。
  - **解决方案**: 在用户选择工程时，明确告知用户文件将被复制。未来可提供"引用模式"（只记录路径不复制）作为高级选项。
- **性能 (大量文件)**:
  - **挑战**: 当工程文件夹内图片数量巨大时，启动加载和渲染可能变慢。
  - **解决方案**: 实现分页加载或虚拟滚动技术，只渲染视口内的图片。
- **用户体验 (API Key配置)**:
  - **挑战**: 非技术用户可能不了解如何获取和配置API密钥。
  - **解决方案**: (未来阶段) 提供清晰、图文并茂的引导教程。

## 8. 发展路线图 (Development Roadmap)

- **第一阶段: 可行产品 (MVP)**
    - **核心**: 实现以"工程"为基础的文件管理系统。
    - 用户可以选择/创建工程文件夹，路径被持久化保存。
    - 实现将外部图片（单张/文件夹）**复制**到工程文件夹的功能。
    - 在界面上展示工程文件夹内的所有图片。

- **第二阶段: 数据库与元数据集成**
    - 在工程文件夹内引入SQLite数据库。
    - 将图片信息（路径等）写入数据库，应用通过查询数据库来展示图片。
    - 集成EXIF数据读取，并存入数据库。

- **第三阶段: AI功能集成**
    - 创建可配置VLM提供商（API密钥/端点）的设置界面。
    - 建立后台处理队列，为图片生成AI描述并存入数据库。
    - 实现基于FTS的关键词搜索。
