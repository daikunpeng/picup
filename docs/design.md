# 智能相册应用 - 项目设计文档（开源工具版）

**版本**：2.0  
**日期**：2025年6月22日

## 1. 项目定位

本项目是一个开源工具，旨在为用户提供隐私优先、本地存储、可自由配置的个人照片管理与检索解决方案。

---

## 2. 项目概述

本项目致力于开发一款现代化的智能相册开源工具。  
核心创新点：利用先进的视觉语言模型（VLM）技术，为用户照片自动生成文本描述。  
所有照片和元数据均存储在本地，确保数据隐私与安全。  
通过图像内容转化为可搜索文本，用户可用自然语言高效检索照片，并对AI模型的选择和使用拥有完全控制权。

---

## 3. 项目目标

### 核心目标

- 实现基于图片内容的自然语言搜索，所有数据处理均在本地完成。

### 次要目标

- **用户自主性**：允许用户自由配置VLM服务商及API密钥，不绑定特定服务。
- **隐私优先**：所有图片文件和描述数据默认本地存储，不上传云端。
- **自动化管理**：自动提取照片EXIF数据（拍摄时间、地理位置），形成完整本地元数据。
- **易用性**：简洁明了的图形界面，简化安装和配置流程。
- **可扩展性**：模块化代码结构，便于社区贡献新AI模型或功能。

---

## 4. 核心功能

- **照片导入**：支持从本地文件夹导入照片。
- **AI自动描述**：调用用户配置的VLM模型为照片生成内容描述。
- **AI服务商配置**：设置界面允许输入不同VLM提供商的API密钥和端点。
- **EXIF数据整合**：自动读取并整合照片拍摄时间与GPS信息。
- **本地全文搜索**：强大的搜索栏，对本地数据库描述进行全文检索。
- **描述编辑**：允许用户查看、编辑和完善AI生成的描述。

---

## 5. 技术架构

本工具采用本地化应用架构，简化部署，无需复杂后端服务。推荐使用Electron等桌面应用框架封装，提供跨平台体验。

### 5.1 架构图

```
[用户桌面应用 (Electron封装)]
    |
    |--- [前端界面 (React/Vue)]
    |
    |--- [核心逻辑/本地服务器 (Node.js)]
           |
           | 1. 读取本地图片
           | 2. 调用外部API (使用用户配置)
           |---------------------------------> [第三方VLM API (Google/OpenAI等)]
           |
           | 3. 存储图片与元数据
           v
    [本地数据库 (SQLite)]
```

### 5.2 模块详解

- **应用容器**  
  - 技术栈：Electron 或 Tauri  
  - 职责：将前端和核心逻辑打包为独立桌面应用，支持本地文件系统访问

- **前端**  
  - 技术栈：React、Vue 或 Svelte  
  - 职责：提供照片展示、导入设置、AI服务配置等用户界面

- **核心逻辑**  
  - 技术栈：Node.js（集成在Electron主进程）  
  - 职责：处理界面操作请求，读取本地图片，调用VLM API，操作本地数据库

- **AI提供商接口**  
  - 职责：适配不同VLM API，初版支持Google Gemini和OpenAI GPT

- **数据存储**  
  - 图片文件：引用本地路径或拷贝到指定文件夹，不上传云端
  - 元数据与描述：采用SQLite存储照片路径、EXIF、AI描述、用户标签，利用FTS5实现全文搜索

---

## 6. 核心工作流程

### 6.1 照片导入与处理

1. 用户在应用内选择照片/文件夹导入
2. 应用读取图片文件
3. 应用读取VLM API密钥和端点，将图片数据（Base64编码）发送至API
4. 接收VLM返回描述后，将图片路径、AI描述、EXIF等元数据存入SQLite数据库
5. 前端实时显示新导入照片及描述

### 6.2 照片搜索

1. 用户在搜索框输入查询词
2. 应用对SQLite数据库描述表执行全文搜索（FTS）
3. 前端渲染搜索结果

---

## 7. 数据模型

**Photos 表（SQLite）**

```sql
CREATE TABLE Photos (
  photoId INTEGER PRIMARY KEY AUTOINCREMENT,
  userId TEXT, -- 默认为 'local_user'
  filePath TEXT NOT NULL UNIQUE, -- 本地图片绝对路径
  descriptionAI TEXT,
  descriptionUser TEXT,
  tags TEXT, -- JSON数组，存为TEXT
  takenAt TEXT, -- ISO 8601格式
  location TEXT, -- JSON对象，含lat, lon, name
  createdAt TEXT,
  updatedAt TEXT
);
```

---

## 8. 潜在挑战与解决方案

- **用户体验（API Key配置）**  
  - 挑战：非技术用户不懂如何获取/配置API密钥  
  - 方案：提供图文引导教程，指导用户获取密钥

- **性能（本地处理）**  
  - 挑战：低性能电脑处理大量图片易卡顿  
  - 方案：引入异步处理队列，后台逐一分析，不阻塞UI

- **安装与依赖**  
  - 挑战：开源工具安装过程复杂  
  - 方案：用Electron等打包为原生安装包（.dmg, .exe, .deb），实现一键安装

- **隐私警示**  
  - 挑战：用户需知晓调用云端VLM服务会上传图片  
  - 方案：在API配置界面明确提示用户照片将被发送至所选服务商服务器，并提醒查阅其服务条款和隐私政策

---

## 9. 发展路线图

- **第一阶段：最小可行产品（MVP）**
  - Electron打包应用
  - 支持本地照片导入
  - 可配置VLM服务商（API密钥/端点）
  - SQLite存储数据，FTS关键词搜索

- **第二阶段：功能增强**
  - 支持更多VLM服务商（如本地开源模型）
  - 优化后台处理队列
  - 支持视频文件关键帧提取与分析

- **第三阶段：社区与生态**
  - 建立插件系统，支持社区开发新AI分析功能（如物体识别、人脸聚类等）
  - 提供数据导入/导出功能，方便迁移和备份
