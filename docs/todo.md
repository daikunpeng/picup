# PicUp 项目开发任务清单 (TODO)

本文档根据项目设计文档，为 PicUp 开源项目制定了详细的、迭代式的开发计划。每个阶段都设计为可独立验证的闭环，以确保项目稳步推进。

---

## ✅ 阶段 0: 开发环境配置 (Windows) - (已完成)

- [x] **安装 Node.js, Git, VS Code**
- [x] **初始化项目 (`npm init`)**

---

## ✅ 阶段 1: 实现基于"工程"的 MVP - (已完成)

目标：搭建一个以"工程文件夹"为核心的、可用的最小化产品。

### 任务列表:

- [x] **安装核心依赖**:
  - `electron`: 应用框架。
  - `electron-store`: 用于持久化存储工程路径。
- [x] **实现工程管理**:
  - 在UI上提供"创建/选择工程"的功能。
  - 用户选择的工程路径被持久化保存，应用重启后能自动加载。
  - 根据是否已选择工程，来启用/禁用导入功能。
- [x] **实现图片导入**:
  - 实现"导入单张"和"导入文件夹"功能。
  - 所有被导入的图片都被**复制**到当前激活的工程文件夹中。
- [x] **实现图片展示**:
  - 在UI上渲染出当前工程文件夹内的所有图片。
  - 导入新图片后，UI自动刷新。

### ✅ 验证标准:

- [x] 应用启动后，若无工程则导入按钮禁用；若有则自动加载。
- [x] 可以成功选择或创建一个工程文件夹。
- [x] 导入的图片被成功复制到工程文件夹，并显示在界面上。
- [x] 重启应用后，能自动加载上一次的工程和图片。

---

## 阶段 2: 集成数据库并管理元数据

目标：引入 SQLite 数据库来管理图片信息，为未来的搜索和高级功能奠定基础。

### 任务列表:

- [ ] **安装数据库依赖**:
  - 运行 `npm install better-sqlite3`。
- [ ] **数据库初始化**:
  - 重构主进程逻辑，在**工程文件夹内**创建并初始化一个 `database.db` 文件。
  - 应用启动并加载工程时，同时连接到该数据库。
- [ ] **重构图片加载/导入逻辑**:
  - **导入时**: 每当有新图片被复制到工程文件夹时，将其`filePath`等基础信息写入 `Photos` 表。
  - **加载时**: 应用不再是直接读取文件系统来展示图片，而是从数据库的 `Photos` 表中查询所有记录，并根据 `filePath` 来渲染图片。
- [ ] **集成 EXIF 数据读取**:
  - 安装 EXIF 读取库 (如 `exif-reader`)。
  - 在图片被导入（即写入数据库）时，解析其 EXIF 信息（拍摄时间、地理位置等），并一并存入 `Photos` 表的相应字段。
- [ ] **在 UI 中展示元数据**:
  - (可选) 在图片详情视图或鼠标悬停提示中，显示从数据库读取的拍摄时间等信息。

### ✅ 验证标准:

- 选择工程后，一个 `database.db` 文件出现在该文件夹中。
- 导入新图片后，即使删除图片再重新生成，应用重启后依然能看到图片列表（因为记录在数据库中）。(注：此阶段图片文件需保留)
- 关闭并重新打开应用，图片列表能从数据库中成功加载。
- 对于带EXIF信息的照片，其元数据能被正确提取并存储。

---

## ✅ 阶段 3: AI 功能集成与全文搜索 - (已完成)

目标：接入 VLM 模型，实现应用的核心亮点——AI描述与自然语言搜索。

### 📝 进度笔记 (2024-12-28) - 阶段3完成

**已完成的核心功能:**
- ✅ **AI服务集成**: 成功切换并集成 Moonshot AI API，实现图片智能描述生成
- ✅ **后台处理队列**: 实现稳定的异步处理机制，支持大批量图片处理
- ✅ **数据库集成**: 完整的SQLite + better-sqlite3 集成，支持元数据和AI描述存储
- ✅ **FTS5全文搜索**: 实现基于AI描述的中文全文搜索功能
- ✅ **现代化UI**: 卡片式照片展示，实时状态更新，搜索结果高亮
- ✅ **实时更新**: 3秒周期的状态同步，无需刷新即可看到AI处理进度

**解决的技术挑战:**
1. **API切换**: 从Google Gemini成功迁移到Moonshot AI vision API
2. **中文编码**: 解决Windows PowerShell中文显示乱码，确保搜索功能正常
3. **性能优化**: 智能队列管理，避免重复处理已完成的照片
4. **用户体验**: 实现描述直显、状态指示、实时搜索等现代化交互

**最终实现的功能:**
- 🎯 **智能相册**: 自动生成中文照片描述
- 🔍 **全文搜索**: 基于AI描述的快速检索
- 📱 **实时界面**: 处理状态实时可见
- ⚡ **高性能**: 异步处理不阻塞界面
- 🎨 **现代UI**: 卡片式布局和流畅动效

**阶段3验证完成**: 所有核心功能已实现并通过用户测试验证 ✅

### 任务列表:

- [x] **创建AI服务配置界面**:
  - 在前端新增"设置"页面，允许用户输入并保存 VLM 提供商的 `API Key` 和 `Endpoint URL` (使用 `electron-store` 存储)。
- [x] **建立后台处理队列**:
  - 创建一个稳健的后台任务队列，用于处理AI描述生成，避免阻塞UI。
  - 图片导入后，将待处理的任务（`photoId`）添加到队列中。
- [x] **实现 AI 描述生成**:
  - 编写队列处理器，为队列中的每张图片调用 VLM API 生成描述。
  - 将返回的 `descriptionAI` 文本更新到数据库中对应的记录。
- [x] **启用 FTS5 全文搜索**:
  - 修改数据库初始化逻辑，为 `Photos` 表的描述字段创建 FTS5 虚拟表。
  - 在UI上添加搜索框，实现对 `descriptionAI` 字段的实时全文搜索。
- [x] **在 UI 中展示和更新描述**:
  - 在图片下方展示 AI 生成的描述。
  - 后台队列处理完成后，UI 上的描述能够实时更新。

### ✅ 验证标准:

- [x] 可以成功配置并保存 API Key。
- [x] 导入图片后，其 AI 描述会在稍后自动出现在界面上。
- [x] 在搜索框中输入描述中的关键词，可以实时筛选出匹配的图片。

### 🎉 阶段3成就达成:

**PicUp智能相册核心功能全面完成！**
- ✨ **自动AI描述**: Moonshot AI驱动的中文图片描述生成
- 🔍 **智能搜索**: FTS5全文搜索 + LIKE降级策略，支持中文关键词检索  
- 📱 **现代界面**: 卡片式布局，实时状态更新，搜索结果高亮显示
- ⚡ **高性能**: 异步处理队列，智能状态管理，无阻塞用户体验
- 🛠️ **稳定可靠**: 多重错误处理，编码兼容，向后兼容数据库迁移

用户现在可以享受完整的智能相册体验：导入照片 → 自动AI分析 → 实时搜索描述内容！

---

## 阶段 4: 用户交互与应用打包

目标：完善用户体验，并提供易于分发的安装包。

### 任务列表:
- [ ] **实现描述编辑**:
  - 允许用户点击并编辑 AI 生成的描述，将结果保存到 `descriptionUser` 字段。
  - 搜索功能需要同时覆盖 `descriptionAI` 和 `descriptionUser` 两个字段。
- [ ] **完善用户引导与提示**:
  - 在 API 配置界面提供清晰的引导和隐私风险提示。
- [ ] **安装并配置打包工具**:
  - 运行 `npm install --save-dev electron-builder`。
  - 配置 `package.json` 以支持 Windows 打包。
- [ ] **执行打包**:
  - 运行打包命令，生成 `.exe` 安装程序。

### ✅ 验证标准:
- 用户可以编辑和保存自己的描述。
- 应用内有清晰的帮助和提示信息。
- 可以在 `dist` 目录下找到生成的 `.exe` 文件，并能在其他 Windows 电脑上成功安装和运行。 