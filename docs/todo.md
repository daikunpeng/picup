# PicUp 项目开发任务清单 (TODO)

本文档根据项目设计文档，为 PicUp 开源项目制定了详细的、迭代式的开发计划。每个阶段都设计为可独立验证的闭环，以确保项目稳步推进。

---

## 阶段 0: 开发环境配置 (Windows)

在开始编码前，我们需要在 Windows 系统上搭建一个稳定、一致的开发环境。

### 任务列表:

- [ ] **安装 Node.js**:
  - 从 [Node.js 官网](https://nodejs.org/) 下载并安装最新的 LTS 版本。
  - 打开 PowerShell 或 CMD，运行 `node -v` 和 `npm -v` 确认安装成功。
- [ ] **安装 Git**:
  - 从 [Git 官网](https://git-scm.com/download/win) 下载并安装 Git for Windows。
- [ ] **安装代码编辑器**:
  - 安装 [VS Code](https://code.visualstudio.com/) 或你偏好的其他编辑器。
- [ ] **克隆项目仓库**:
  - (如果需要) `git clone <repository-url>`
- [ ] **初始化项目**:
  - 在项目根目录运行 `npm init -y` 创建 `package.json`。

### ✅ 验证标准:

- 可以在终端中成功执行 `node` 和 `npm` 命令。
- `package.json` 文件已在项目根目录成功创建。

---

## 阶段 1: 创建应用骨架并显示本地图片 (MVP 核心)

目标：搭建一个最基础的 Electron 应用，实现核心的图片读取与展示功能。

### 任务列表:

- [ ] **安装 Electron**:
  - 运行 `npm install --save-dev electron`。
- [ ] **创建主进程文件 (`main.js`)**:
  - 编写基础的 Electron 主进程逻辑，用于创建应用窗口。
- [ ] **创建渲染进程文件 (`index.html`, `renderer.js`)**:
  - `index.html`: 包含一个"导入文件夹"按钮和一个用于展示图片的 div 容器。
  - `renderer.js`: 编写按钮点击事件，调用 Electron 的 `ipcRenderer` 与主进程通信以打开文件对话框。
- [ ] **实现文件夹选择与图片读取**:
  - 在 `main.js` 中，通过 `ipcMain` 监听渲染进程的请求，使用 `dialog.showOpenDialog` 让用户选择文件夹。
  - 读取所选文件夹下的所有图片文件（例如：.jpg, .png）。
  - 将图片文件路径列表返回给渲染进程。
- [ ] **在界面上渲染图片**:
  - 渲染进程接收到图片路径列表后，动态创建 `<img>` 元素并将其显示在 `index.html` 的容器中。

### ✅ 验证标准:

- 应用能够成功启动，并显示一个窗口。
- 点击"导入文件夹"按钮后，可以弹出系统文件夹选择框。
- 选择一个包含图片的文件夹后，所有图片都能以缩略图的形式展示在应用界面上。

---

## 阶段 2: 集成数据库并持久化数据

目标：引入 SQLite 数据库，将图片信息存储起来，使数据能够持久化。

### 任务列表:

- [ ] **安装 SQLite 依赖**:
  - 运行 `npm install better-sqlite3`。
- [ ] **初始化数据库**:
  - 在主进程中，编写一个数据库初始化模块。
  - 应用首次启动时，检查数据库文件是否存在。如果不存在，则创建 `.db` 文件，并根据设计文档执行 `CREATE TABLE Photos (...)` 语句。
- [ ] **重构图片导入逻辑**:
  - 当用户导入图片时，不再是直接渲染，而是将每张图片的 `filePath` 写入 `Photos` 表。
- [ ] **从数据库加载图片**:
  - 应用启动时，或导入完成后，从 `Photos` 表中查询所有记录。
  - 将查询到的 `filePath` 列表传递给渲染进程进行展示。

### ✅ 验证标准:

- 导入一个文件夹后，关闭并重新打开应用，之前导入的图片列表能够自动加载并显示，无需再次手动导入。
- 项目文件夹中出现了一个 SQLite 数据库文件（例如 `picup.db`）。

---

## 阶段 3: 实现 AI 服务配置与基础调用

目标：创建设置界面，允许用户配置自己的 VLM API，并验证 API 调用能成功。

### 任务列表:

- [ ] **安装配置管理工具**:
  - 运行 `npm install electron-store`，用于安全地存储用户配置。
- [ ] **创建设置页面/模态框**:
  - 在前端新增一个"设置"入口。
  - 创建一个包含表单的界面，让用户可以输入 `API Key` 和 `Endpoint URL`。
- [ ] **保存和读取配置**:
  - 当用户保存设置时，使用 `electron-store` 将其存储在本地。
  - 主进程需要能读取这些配置，用于后续的 API 调用。
- [ ] **实现一个测试性的 API 调用**:
  - 在图片导入流程中，选择**一张**图片进行测试。
  - 将图片文件转换为 Base64 编码。
  - 使用 `node-fetch` 或 `axios` 等库，根据用户配置的 API Key 和 Endpoint，向 VLM 服务商发送一个请求。
  - 在主进程的控制台打印出返回的 AI 描述文本。

### ✅ 验证标准:

- 用户可以在设置界面中输入并保存 API Key。
- 重新启动应用后，已保存的 API Key 依然存在。
- 导入图片时，VS Code 或应用的开发者工具控制台能成功打印出 VLM 返回的图片描述，证明 API 调用链路畅通。

---

## 阶段 4: 实现完整的 AI 描述生成与存储

目标：建立一个稳健的后台处理流程，为所有导入的图片生成并存储 AI 描述。

### 任务列表:

- [ ] **建立后台处理队列**:
  - 为避免大量图片处理阻塞 UI，创建一个任务队列。
  - 用户导入文件夹后，将所有待处理的图片任务（包含 `photoId` 和 `filePath`）推入队列。
- [ ] **编写队列处理器**:
  - 在后台异步地、逐一地处理队列中的任务。
  - 对每个任务，执行"图片转 Base64 -> 调用 VLM API -> 获取描述文本"的流程。
- [ ] **将描述存入数据库**:
  - 获取到 AI 描述后，根据任务中的 `photoId`，使用 `UPDATE` 语句将 `descriptionAI` 字段更新到 `Photos` 表的相应记录中。
- [ ] **在界面上显示描述**:
  - 修改前端逻辑，使其在图片缩略图下方显示 `descriptionAI` 字段的内容。
  - 实现一个机制，当后台处理完成一张图片后，能实时更新界面上对应图片的描述。

### ✅ 验证标准:

- 导入一个包含多张图片的文件夹后，应用不会卡死。
- 可以在界面上看到图片的描述被逐一填充上。
- 关闭并重启应用后，已生成的描述能够和图片一起被加载显示。

---

## 阶段 5: 实现核心功能 - 全文搜索 (FTS)

目标：利用 SQLite 的 FTS5 扩展，实现高效的自然语言搜索。

### 任务列表:

- [ ] **启用 FTS5**:
  - 修改数据库初始化逻辑，为 `Photos` 表创建一个 FTS5 虚拟表，并将其与 `descriptionAI` 列关联。
  - 设计好数据同步机制（例如使用触发器），当 `Photos` 表更新时，FTS 表也同步更新。
- [ ] **添加搜索框 UI**:
  - 在 `index.html` 中添加一个 `<input type="search">` 搜索框。
- [ ] **实现搜索逻辑**:
  - 监听搜索框的 `input` 事件。
  - 每当用户输入文本时，将查询词发送到主进程。
  - 主进程执行 FTS 查询 (`SELECT ... FROM ... WHERE ... MATCH ?`)。
  - 将匹配到的照片记录返回给渲染进程。
- [ ] **动态更新搜索结果**:
  - 渲染进程根据返回的结果，动态地过滤和刷新界面上显示的图片列表。

### ✅ 验证标准:

- 在搜索框中输入 AI 描述中包含的关键词（例如"天空"、"小狗"）。
- 图片列表会实时地筛选出符合条件的照片。
- 搜索功能即使在大量数据下也应保持流畅。

---

## 阶段 6: 完善元数据与用户交互

目标：提取更多有用的信息，并允许用户对 AI 生成的内容进行修正。

### 任务列表:

- [ ] **集成 EXIF 数据读取**:
  - 安装一个 EXIF 读取库（如 `exif-reader`）。
  - 在图片导入时，解析照片的 EXIF 信息，提取"拍摄时间"和"地理位置"。
  - 将 `takenAt` 和 `location` 存入数据库。
- [ ] **实现描述编辑功能**:
  - 当用户点击某张图片的描述时，将其转换为一个可编辑的文本框。
  - 用户编辑完成后，将修改后的内容保存到 `descriptionUser` 字段。
  - 搜索功能应同时覆盖 `descriptionAI` 和 `descriptionUser` 两个字段。
- [ ] **在 UI 中展示元数据**:
  - 在照片的详情视图或浮动提示中，显示拍摄时间和地点等信息。

### ✅ 验证标准:

- 导入带 GPS 信息的照片后，可以在界面上看到其拍摄时间和地点。
- 用户可以成功修改 AI 生成的描述，且修改后的内容被永久保存。
- 搜索时，可以搜到用户自己添加的描述内容。

---

## 阶段 7: 应用打包与发布准备

目标：将应用打包成一个易于分发的安装程序，并完善用户引导。

### 任务列表:

- [ ] **安装打包工具**:
  - 运行 `npm install --save-dev electron-builder`。
- [ ] **配置 `package.json`**:
  - 添加 `build` 脚本和 `electron-builder` 的相关配置，指定目标平台（Windows）、应用图标等。
- [ ] **完善用户引导**:
  - 在设置界面中添加清晰的图文链接或说明，指导用户如何从主流 VLM 服务商获取 API Key。
- [ ] **添加隐私警示**:
  - 根据设计文档，在配置 API 的界面明确提示用户数据将会被发送给第三方。
- [ ] **执行打包命令**:
  - 运行 `npm run build` 或类似命令。

### ✅ 验证标准:

- 项目的 `dist` 或 `release` 目录下成功生成了一个 `.exe` 安装程序。
- 该安装程序可以在另一台干净的 Windows 电脑上成功安装并运行应用。
- 应用内的引导和提示信息清晰明了。 